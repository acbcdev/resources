---
/**
 * HeroCarousel Component
 * Large carousel showcasing featured content on homepage
 * Auto-plays with 5-second interval
 * Includes navigation arrows, badges, and responsive design
 */

import { Carousel } from '@/features/ui/carousel';
import CarouselContent from '@/features/ui/carousel/CarouselContent.astro';
import CarouselItem from '@/features/ui/carousel/CarouselItem.astro';
import CarouselNext from '@/features/ui/carousel/CarouselNext.astro';
import CarouselPrevious from '@/features/ui/carousel/CarouselPrevious.astro';
import CarouselDots from '@/features/ui/carousel/CarouselDots.astro';
import { Button } from '@/features/ui/button';
import { Badge } from '@/features/ui/badge';
import { Play } from 'lucide-react';
import { HOMEPAGE, CTA } from '@/features/common/consts/text';

interface Props {
	items: Array<{
		id: string;
		type: 'resource' | 'collection';
		name: string;
		description: string;
		url: string;
		og?: { image?: string; description?: string };
	}>;
}

const { items } = Astro.props;

if (!items || items.length === 0) {
	throw new Error('HeroCarousel requires at least one item');
}
---

<section class="w-full mb-8 px-4 sm:mb-16 lg:px-6 max-w-full">
	<Carousel
		opts={{
			loop: true,
			align: 'start',
			skipSnaps: false,
			dragFree: false,
		}}
		class="w-full"
	>
		<CarouselContent>
			{
				items.map((item) => {
					// Split name for blue text accent - highlight last word
					const words = item.name.split(' ');
					const lastWord = words.pop();
					const firstPart = words.join(' ');

					return (
						<CarouselItem>
							<div class="group relative aspect-[4/3] sm:aspect-video lg:aspect-[3/1] overflow-hidden rounded-2xl sm:rounded-3xl min-h-[250px] sm:min-h-[300px] max-h-[400px] flex items-stretch">
								{/* Featured Resource Badge */}
								<Badge
									variant="default"
									size="md"
									class="absolute top-4 left-4 z-20 backdrop-blur-sm"
								>
									{HOMEPAGE.hero.featuredBadge}
								</Badge>

								<img
									src={item.og?.image || 'https://placehold.co/1200x400'}
									alt={item.name}
									class="absolute inset-0 w-full h-full object-cover object-center transition-transform duration-300 ease-out group-hover:scale-105"
									loading={item === items[0] ? 'eager' : 'lazy'}
								/>
								<div
									class="absolute inset-0 flex items-end p-4 px-6 sm:p-6 sm:px-8 lg:p-10 lg:px-12 z-10"
									style="background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 30%, rgba(0,0,0,0.85) 60%, rgba(0,0,0,1) 100%)"
								>
									<div class="w-full text-white bg-black/70 -mx-6 px-6 py-4 sm:-mx-8 sm:px-8 lg:-mx-12 lg:px-12 rounded-b-2xl sm:rounded-b-3xl">
										{/* Heading with blue text accent */}
										<h2 class="text-xl sm:text-2xl lg:text-4xl font-bold mb-1 sm:mb-2 lg:mb-3 leading-tight">
											<span class="text-white">{firstPart}</span>
											{firstPart && ' '}
											<span class="text-primary">{lastWord}</span>
										</h2>
										<p class="text-sm sm:text-base lg:text-lg mb-3 sm:mb-4 lg:mb-6 max-w-2xl text-white/95 leading-relaxed line-clamp-2 sm:line-clamp-3">
											{item.description}
										</p>

										{/* Two Buttons */}
										<div class="flex flex-wrap gap-3">
											{item.type === 'collection' ? (
												<Button href={item.url} variant="default" size="md">
													{CTA.viewCollection}
												</Button>
											) : (
												<Button href={item.url} target="_blank" rel="noopener noreferrer" variant="default" size="md">
													{CTA.getStarted}
												</Button>
											)}
											{/* TODO: Add demoUrl field to item data for real demo links */}
											<Button href={item.url} variant="outline" size="md">
												<Play size={16} />
												{CTA.watchDemo}
											</Button>
										</div>
									</div>
								</div>
							</div>
						</CarouselItem>
					);
				})
			}
		</CarouselContent>
		<CarouselPrevious />
		<CarouselNext />
	</Carousel>

	<!-- Carousel Dots Navigation -->
	<CarouselDots count={items.length} />
</section>

<script>
	/**
	 * Auto-play carousel with 5-second interval
	 * Pause on hover, resume on mouse leave
	 */
	function initCarouselAutoPlay() {
		const carousels = document.querySelectorAll(
			'.hero-carousel-section .starwind-carousel',
		) as NodeListOf<HTMLElement>;

		carousels.forEach((carousel) => {
			let autoPlayInterval: ReturnType<typeof setInterval> | null = null;

			function startAutoPlay() {
				if (autoPlayInterval) clearInterval(autoPlayInterval);

				autoPlayInterval = setInterval(() => {
					const nextButton = carousel.querySelector(
						'[data-slot="carousel-next"]',
					) as HTMLButtonElement;
					if (nextButton) {
						nextButton.click();
					}
				}, 5000); // 5 seconds
			}

			function stopAutoPlay() {
				if (autoPlayInterval) clearInterval(autoPlayInterval);
			}

			// Start autoplay on load
			setTimeout(startAutoPlay, 500);

			// Pause on hover
			carousel.addEventListener('mouseenter', stopAutoPlay);
			carousel.addEventListener('mouseleave', startAutoPlay);

			// Pause on button click
			const buttons = carousel.querySelectorAll(
				'[data-slot="carousel-previous"], [data-slot="carousel-next"]',
			);
			buttons.forEach((button) => {
				button.addEventListener('click', () => {
					stopAutoPlay();
					setTimeout(startAutoPlay, 7000);
				});
			});
		});
	}

	// Initialize on page load and after Astro transitions
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initCarouselAutoPlay);
	} else {
		initCarouselAutoPlay();
	}

	document.addEventListener('astro:after-swap', initCarouselAutoPlay);
</script>
