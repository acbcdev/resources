---
/**
 * HeroCarousel Component
 * Large carousel showcasing featured content on homepage
 * Auto-plays with 5-second interval
 * Includes navigation arrows and responsive design
 */

import { Carousel } from '@/features/ui/carousel';
import CarouselContent from '@/features/ui/carousel/CarouselContent.astro';
import CarouselItem from '@/features/ui/carousel/CarouselItem.astro';
import CarouselNext from '@/features/ui/carousel/CarouselNext.astro';
import CarouselPrevious from '@/features/ui/carousel/CarouselPrevious.astro';

interface Props {
	items: Array<{
		id: string;
		type: 'resource' | 'collection';
		name: string;
		description: string;
		url: string;
		og?: { image?: string; description?: string };
	}>;
}

const { items } = Astro.props;

if (!items || items.length === 0) {
	throw new Error('HeroCarousel requires at least one item');
}
---

<section class="w-full mb-8 px-4 sm:mb-16 lg:px-6 max-w-full">
	<Carousel
		opts={{
			loop: true,
			align: 'start',
			skipSnaps: false,
			dragFree: false,
		}}
		class="w-full"
	>
		<CarouselContent>
			{
				items.map((item) => (
					<CarouselItem>
						<div class="group relative aspect-[4/3] sm:aspect-video lg:aspect-[3/1] overflow-hidden rounded-2xl sm:rounded-3xl min-h-[250px] sm:min-h-[300px] max-h-[400px] flex items-stretch">
							<img
								src={item.og?.image || 'https://placehold.co/1200x400'}
								alt={item.name}
								class="absolute inset-0 w-full h-full object-cover object-center transition-transform duration-300 ease-out group-hover:scale-105"
								loading={item === items[0] ? 'eager' : 'lazy'}
							/>
							<div
								class="absolute inset-0 flex items-end p-4 px-6 sm:p-6 sm:px-8 lg:p-10 lg:px-12 z-10"
								style="background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 30%, rgba(0,0,0,0.85) 60%, rgba(0,0,0,1) 100%)"
							>
								<div class="w-full text-white bg-black/70 -mx-6 px-6 py-4 sm:-mx-8 sm:px-8 lg:-mx-12 lg:px-12 rounded-b-2xl sm:rounded-b-3xl">
									<h2 class="text-xl sm:text-2xl lg:text-4xl font-bold mb-1 sm:mb-2 lg:mb-3 leading-tight">
										{item.name}
									</h2>
									<p class="text-sm sm:text-base lg:text-lg mb-3 sm:mb-4 lg:mb-6 max-w-2xl text-white/95 leading-relaxed line-clamp-2 sm:line-clamp-3">
										{item.description}
									</p>
									{item.type === 'collection' ? (
										<a
											href={item.url}
											class="inline-flex items-center px-4 py-2 sm:px-5 sm:py-2.5 lg:px-6 lg:py-3 bg-primary text-primary-foreground no-underline rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 border-2 border-primary cursor-pointer hover:opacity-90 hover:shadow-lg hover:-translate-y-0.5"
										>
											View Collection
										</a>
									) : (
										<a
											href={item.url}
											target="_blank"
											rel="noopener noreferrer"
											class="inline-flex items-center px-4 py-2 sm:px-5 sm:py-2.5 lg:px-6 lg:py-3 bg-primary text-primary-foreground no-underline rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 border-2 border-primary cursor-pointer hover:opacity-90 hover:shadow-lg hover:-translate-y-0.5"
										>
											Visit Resource
										</a>
									)}
								</div>
							</div>
						</div>
					</CarouselItem>
				))
			}
		</CarouselContent>
		<CarouselPrevious />
		<CarouselNext />
	</Carousel>
</section>

<script>
	/**
	 * Auto-play carousel with 5-second interval
	 * Pause on hover, resume on mouse leave
	 */
	function initCarouselAutoPlay() {
		const carousels = document.querySelectorAll(
			'.hero-carousel-section .starwind-carousel',
		) as NodeListOf<HTMLElement>;

		carousels.forEach((carousel) => {
			let autoPlayInterval: ReturnType<typeof setInterval> | null = null;

			function startAutoPlay() {
				if (autoPlayInterval) clearInterval(autoPlayInterval);

				autoPlayInterval = setInterval(() => {
					const nextButton = carousel.querySelector(
						'[data-slot="carousel-next"]',
					) as HTMLButtonElement;
					if (nextButton) {
						nextButton.click();
					}
				}, 5000); // 5 seconds
			}

			function stopAutoPlay() {
				if (autoPlayInterval) clearInterval(autoPlayInterval);
			}

			// Start autoplay on load
			setTimeout(startAutoPlay, 500);

			// Pause on hover
			carousel.addEventListener('mouseenter', stopAutoPlay);
			carousel.addEventListener('mouseleave', startAutoPlay);

			// Pause on button click
			const buttons = carousel.querySelectorAll(
				'[data-slot="carousel-previous"], [data-slot="carousel-next"]',
			);
			buttons.forEach((button) => {
				button.addEventListener('click', () => {
					stopAutoPlay();
					setTimeout(startAutoPlay, 7000);
				});
			});
		});
	}

	// Initialize on page load and after Astro transitions
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initCarouselAutoPlay);
	} else {
		initCarouselAutoPlay();
	}

	document.addEventListener('astro:after-swap', initCarouselAutoPlay);
</script>
