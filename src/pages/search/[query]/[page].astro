---
/**
 * Search Results Page
 * Displays full search results for a given query
 *
 * Currently generates static routes for common searches
 * Future: Convert to SSR for dynamic search
 */

import type { GetStaticPaths } from 'astro';
import { DATA } from '@/data';
import Layout from '@/layouts/Layout.astro';
import ListResources from '@/features/common/lists/ListResources.astro';

export const getStaticPaths = (({ paginate }) => {
	// For now, generate static pages for "all" query
	// This shows all resources, demonstrating the search results layout
	// Future: Convert to SSR to handle dynamic queries

	const allResults = DATA.filter((d) => d.name && d.url);

	return paginate(allResults, {
		params: { query: 'all' },
		pageSize: 20,
	});
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const { query } = Astro.params;

// Decode query from URL if needed
const decodedQuery = decodeURIComponent(query || 'all');
---

<Layout title={`Search results for "${decodedQuery}"`}>
	<div class="search-results-container">
		<div class="search-results-header">
			<h1>Search Results</h1>
			<p class="search-query">
				{
					query === 'all'
						? `Showing all ${page.data.length} resources`
						: `Found ${page.data.length} results for "${decodedQuery}"`
				}
			</p>
		</div>

		{
			page.data.length > 0 ? (
				<>
					<ListResources resources={page.data} />

					<div class="pagination-container">
						{/* Pagination will be added in future enhancement */}
					</div>
				</>
			) : (
				<div class="no-results">
					<p>No resources found for "{decodedQuery}"</p>
					<p>
						<a href="/">Back to homepage</a>
					</p>
				</div>
			)
		}
	</div>
</Layout>

<style>
	.search-results-container {
		max-width: 1400px;
		margin: 0 auto;
	}

	.search-results-header {
		margin-bottom: 2rem;
	}

	.search-results-header h1 {
		font-size: 2rem;
		font-weight: bold;
		margin-bottom: 0.5rem;
		background: var(--accent-gradient);
		background-clip: text;
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
	}

	.search-query {
		color: rgba(255, 255, 255, 0.6);
		font-size: 1.1rem;
	}

	.search-query strong {
		color: rgb(var(--accent));
	}

	.no-results {
		text-align: center;
		padding: 3rem 1rem;
	}

	.no-results p {
		color: rgba(255, 255, 255, 0.7);
		font-size: 1.1rem;
		margin-bottom: 1rem;
	}

	.no-results a {
		color: rgb(var(--accent));
		text-decoration: none;
		transition: all 0.3s ease;
	}

	.no-results a:hover {
		text-decoration: underline;
	}

	.pagination-container {
		display: flex;
		justify-content: center;
		margin-top: 3rem;
		margin-bottom: 2rem;
	}
</style>
