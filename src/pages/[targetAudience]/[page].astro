---
import type { GetStaticPaths } from 'astro';
import { TARGETAUDIENCE } from '@/features/audiences/types/audience';
import { slugify } from '@/features/common/lib/utils';
import ListResources from '@/features/resources/lists/ListResources.astro';
import { DATA } from '@/data';
import Layout from '@/layouts/Layout.astro';
import {
	Pagination,
	PaginationContent,
	PaginationEllipsis,
	PaginationItem,
	PaginationLink,
	PaginationNext,
	PaginationPrevious,
} from '@/features/ui/pagination';
export const getStaticPaths = (({ paginate }) => {
	return TARGETAUDIENCE.flatMap((item) => {
		const fixTag = slugify(item);
		const filteredItems = DATA.filter((i) => i?.targetAudience?.includes(item));
		return paginate(filteredItems, {
			params: { targetAudience: fixTag },
			props: { targetAudience: item },
			pageSize: 14,
		});
	});
}) satisfies GetStaticPaths;
const { page, targetAudience } = Astro.props;
const { data, url } = page;
---

<Layout title={`Resources for ${targetAudience}`} subTitle={targetAudience}>
	<nav class="flex gap-2 items-center justify-center my-4">
		{
			TARGETAUDIENCE.map((item) => (
				<a
					class="bg-background duration-200 text-2xl px-4 py-2 rounded-3xl hover:scale-110"
					href={`/${slugify(item)}/1`}
					transition:name={item}
				>
					{item}
				</a>
			))
		}
	</nav>
	<ListResources resources={data} class="mx-40" />
	<Pagination>
		<PaginationContent>
			{
				url.prev && (
					<PaginationItem>
						<PaginationPrevious href={url.prev} />
					</PaginationItem>
				)
			}
			{
				Array.from({ length: page.lastPage }, (_, i) => i + 1).map((pageNum) => (
					<PaginationItem>
						<PaginationLink
							href={`/${slugify(targetAudience)}/${pageNum}`}
							isActive={pageNum === page.currentPage}
						>
							{pageNum}
						</PaginationLink>
					</PaginationItem>
				))
			}
			{
				url.next && (
					<PaginationItem>
						<PaginationNext href={url.next} />
					</PaginationItem>
				)
			}
		</PaginationContent>
	</Pagination>
</Layout>
