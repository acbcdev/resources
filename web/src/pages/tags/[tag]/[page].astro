---
import type { GetStaticPaths } from 'astro';
import { DATA } from 'web/src/data/index';
import { slugify } from 'web/src/features/common/lib/utils';
import LayoutCategories from '@/layouts/LayoutCategories.astro';
import ListResources from '@/features/common/lists/ListResources.astro';
import {
	Pagination,
	PaginationContent,
	PaginationEllipsis,
	PaginationItem,
	PaginationLink,
	PaginationNext,
	PaginationPrevious,
} from 'web/src/features/ui/pagination';

export const getStaticPaths = (({ paginate }) => {
	const allTags = [...new Set(DATA.flatMap((i) => i.tags).filter(Boolean))];
	return allTags.flatMap((tag) => {
		const filteredItems = DATA.filter((i) => i.tags.includes(tag));
		const fixTag = slugify(tag);
		return paginate(filteredItems, {
			params: { tag: fixTag },
			pageSize: 14,
		});
	});
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<LayoutCategories title="Tags">
	<ListResources resources={page.data} />
	<Pagination>
		<PaginationContent>
			{
				page.url.prev && (
					<PaginationItem>
						<PaginationPrevious href={page.url.prev} />
					</PaginationItem>
				)
			}
			{
				Array.from({ length: page.lastPage }, (_, i) => i + 1).map((pageNum) => (
					<PaginationItem>
						<PaginationLink
							href={`/tags/${page.url.current?.split('/')[2] || ''}/${pageNum}`}
							isActive={pageNum === page.currentPage}
						>
							{pageNum}
						</PaginationLink>
					</PaginationItem>
				))
			}
			{
				page.url.next && (
					<PaginationItem>
						<PaginationNext href={page.url.next} />
					</PaginationItem>
				)
			}
		</PaginationContent>
	</Pagination>
</LayoutCategories>
