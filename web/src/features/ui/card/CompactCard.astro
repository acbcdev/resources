---
import type { HTMLAttributes } from "astro/types";
import { tv, type VariantProps } from "tailwind-variants";

interface Props extends HTMLAttributes<"div">, VariantProps<typeof compactCard> {
	href?: string;
	title: string;
	description?: string;
	badge?: string;
	iconUrl?: string;
	showIndicator?: boolean;
	showChevron?: boolean;
}

export const compactCard = tv({
	base: [
		"group relative flex items-center gap-4 bg-card text-card-foreground rounded-xl border border-border/50 p-4",
		"starwind-transition-colors",
	],
	variants: {
		variant: {
			default: "hover:border-border hover:bg-muted/30",
			active: "border-primary/50 bg-primary/5",
		},
	},
	defaultVariants: { variant: "default" },
});

export const compactCardIcon = tv({
	base: "size-12 rounded-xl bg-muted flex items-center justify-center flex-shrink-0 overflow-hidden",
});

export const compactCardBody = tv({
	base: "flex-1 min-w-0",
});

export const compactCardTitle = tv({
	base: "font-semibold text-foreground truncate",
});

export const compactCardDescription = tv({
	base: "text-sm text-muted-foreground truncate",
});

export const compactCardBadge = tv({
	base: "px-2 py-0.5 text-xs rounded-md bg-muted text-muted-foreground flex-shrink-0",
});

export const compactCardIndicator = tv({
	base: "size-2 rounded-full bg-primary flex-shrink-0",
});

export const compactCardChevron = tv({
	base: "size-5 text-muted-foreground flex-shrink-0 transition-transform group-hover:translate-x-0.5",
});

const {
	variant,
	href,
	title,
	description,
	badge,
	iconUrl,
	showIndicator,
	showChevron,
	class: className,
	...rest
} = Astro.props;

const Tag = href ? "a" : "div";
---

<Tag
	class={compactCard({ variant, class: className })}
	href={href}
	data-slot="compact-card"
	{...rest}
>
	<!-- Icon -->
	<div class={compactCardIcon()}>
		{
			iconUrl ? (
				<img src={iconUrl} alt="" class="size-full object-cover" />
			) : (
				<slot name="icon">
					<svg
						class="size-5 text-muted-foreground"
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
						fill="none"
						stroke="currentColor"
						stroke-width="2"
					>
						<path d="M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3" />
					</svg>
				</slot>
			)
		}
	</div>

	<!-- Body -->
	<div class={compactCardBody()}>
		<span class={compactCardTitle()}>{title}</span>
		{description && <p class={compactCardDescription()}>{description}</p>}
	</div>

	<!-- Right side elements -->
	{badge && <span class={compactCardBadge()}>{badge}</span>}

	{showIndicator && <span class={compactCardIndicator()}></span>}

	{
		showChevron && (
			<svg
				class={compactCardChevron()}
				xmlns="http://www.w3.org/2000/svg"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				stroke-linecap="round"
				stroke-linejoin="round"
			>
				<path d="m9 18 6-6-6-6" />
			</svg>
		)
	}
</Tag>
